# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö üíæ

–ë–î —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏–∞–ª–µ–∫—Ç PostgreSQL –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [libpqxx](https://github.com/jtv/libpqxx).

–î–ª—è —Ä–∞–±–æ—Ç—ã –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è docker-compose –∏ pgAdmin.

## –ù–∞–≤–∏–≥–∞—Ü–∏—è üó∫Ô∏è

- [Docker —Ñ–∞–π–ª](../src/database/docker-compose.yml)
- [DDL –∑–∞–ø—Ä–æ—Å—ã](../src/database/vkgram_db_ddl.sql)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å libpqxx](../src/database/database_config.h)
- [–ú–æ–¥—É–ª—å —Å–µ—Ä–≤–µ—Ä–∞, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ —Å–≤—è–∑—å —Å –ë–î](../src/server/server_database_module.h)

## –õ–æ–≥–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

![](../images/db_logic.jpg)

## –û–ø–∏—Å–∞–Ω–∏–µ

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤—Å–µ–≥–æ –¥–≤–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –í vkgram.users —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, username –∏ –ø–∞—Ä–æ–ª—å.
–í vkgram.messages —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≤–∏–¥–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è, 
–≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.

## –°–∫—Ä–∏–Ω—à–æ—Ç—ã üì∏

<img src="../images/db_users.png" alt="drawing" width="600"/>
<img src="../images/db_mes.png" alt="drawing" width="900"/>

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –ë–î üìñ

### –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã:

- docker-compose


### 1. –ó–∞–ø—É—Å–∫ –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

–ò–∑ [–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏](../src/database) –≤—ã–ø–æ–ª–Ω—è–µ–º

```docker-compose up -d```

–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

```docker-compose down```

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏–∑ pgAdmin:

–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ _pgadmin_ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã –¥–ª—è –≤—Ö–æ–¥–∞: –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –∏ –ø–∞—Ä–æ–ª—å:

- email: admin@admin.com
- password: root

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫—Ä—ã—Ç—å pgAdmin, –ø–µ—Ä–µ–π–¥—è –Ω–∞ localhost:8080 –≤ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –≤—Ö–æ–¥–∞ —Ç–æ—Ç –∂–µ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –∏ –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–î–∞–ª–µ–µ –≤—ã–±–∏—Ä–∞–µ–º `Servers` > `Register` > `Server...`:

<img src="../images/db_instruction_1.png" alt="drawing" width="900"/>

–£–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ä–∞–∑–¥–µ–ª `Connection` —Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

- Host name/address (–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞): `postgres_db`
- Port: `5432` 
- Maintenance database: `pg_db` 
- User: `postgres` 
- Password: `postgres`

<img src="../images/db_instruction_2.png" alt="drawing" width="900"/>


### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å [DDL —Å–∫—Ä–∏–ø—Ç—ã](../src/database/vkgram_db_ddl.sql) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π

### 4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `pgadmin`, –æ–Ω –Ω–∞–º –±–æ–ª—å—à–µ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è.

### 5. –ë–î –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ ‚ú®